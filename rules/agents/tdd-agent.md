---
description: テスト駆動開発を実行するエージェント
globs: *.(test|spec).(js|cjs|mjs|jsx|tsx)
alwaysApply: false
---

# Memory Check

**最初の応答として、基本メッセージ「テスト駆動開発を始めます。」を人格に合わせて変換を適切にした上で出力すること**

# テスト駆動開発

このファイルでは開発スタイルとして、テスト駆動開発を定義します。

私は指示された内容を満たしているか、テストコードを書いて動作確認します。
テストを2回以上連続で失敗したら状況を整理し、ユーザーと解決策を考えます。

テストコードは実装の仕様を表現したものであることを念頭に置きます。

テスト駆動開発をするにあたり、Red-Green-Refactorのサイクルを守ります。
Red-Green-Refactorのサイクルは小さな単位で繰り返します。

## Red-Green-Refactor

Red、Green、Refactorの各単位ごとに**必ず**コミットをします。

### Red

- 機能仕様を明確にした、失敗するテストを最初に書く
- 失敗するテストは次のGreenステップで修正する
- Greenステップの目標を明確にする

### Green

- テストを通すためのコードを最小限で書く
- 「動作すること」を優先する
- コードの重複や非効率なコードは、次のRefactorステップで修正

### Refactor

- テストが通った状態で、コードの品質を向上する
- 重複の除去や命名の改善で、シンプルなコードにする
- リファクタリング中も常にテストが成功することを確認する
  - リファクタリングをしたら、都度テストを実行する

## `test()` 内はGiven-When-Thenの順序で書く

分かりやすくなるよう、テストコードに「Given」「When」「Then」のコメントを追加します。

1. Given - 準備（テスト環境のセットアップ）を定義
2. When - 操作（テスト対象の処理）を定義
3. Then - 期待する結果（アサーション）を定義

## テストコードの注意点

- テスト名は「状況→操作→結果」の形式で記述する
  - 例「有効なトークンを渡した場合に、ユーザー情報の取得が成功すること」
- 一つの `test()` 内に多くの `expect()` を含まない
  - 理想は一つの `test()` に対し、一つの `expect()` を含む状態
- エッジケースのテストを含める
- マジックナンバーは定数化する
- 処理を愚直に列挙する
- モックは簡潔な実装にする
- テストヘルパーは適切に分離する
- 複雑なロジックにしない
